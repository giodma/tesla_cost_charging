<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tesla Charging Calculator</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Calcola il costo di ricarica per auto elettriche Tesla e altre. App PWA veloce e offline.">
    <meta name="theme-color" content="#10b981">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Charging Calc">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1024 1024'%3E%3Crect width='1024' height='1024' rx='240' fill='%23e53e3e'/%3E%3Crect x='200' y='250' width='380' height='520' rx='30' fill='white'/%3E%3Crect x='240' y='290' width='300' height='160' rx='15' fill='%23c53030'/%3E%3Cpath d='M330 330 L390 410 L360 410 L420 470 L360 390 L390 390 L330 330 Z' fill='white'/%3E%3Cpath d='M280 480 L380 620 L330 620 L430 720 L330 580 L380 580 L280 480 Z' fill='%23e53e3e'/%3E%3Cpath d='M600 380 Q680 340 730 420 Q780 500 730 580 Q680 660 600 620' stroke='white' stroke-width='50' fill='none' stroke-linecap='round'/%3E%3Crect x='700' y='560' width='100' height='70' rx='15' fill='white'/%3E%3Crect x='720' y='540' width='15' height='30' fill='white'/%3E%3Crect x='765' y='540' width='15' height='30' fill='white'/%3E%3Crect x='160' y='730' width='460' height='50' rx='25' fill='white'/%3E%3C/svg%3E">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="icons/icon-192.png">
    <link rel="apple-touch-icon" sizes="192x192" href="icons/icon-192.png">
    <link rel="apple-touch-icon" sizes="512x512" href="icons/icon-512.png">
    
    <!-- Manifest Link -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        .modern-slider::-webkit-slider-thumb {
            appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #10b981;
            cursor: pointer;
            border: 3px solid #ffffff;
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
            transition: all 0.2s ease;
        }

        .modern-slider::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
        }

        .modern-slider.target::-webkit-slider-thumb {
            background: #059669;
        }

        .modern-slider::-webkit-slider-track {
            background: #e5e7eb;
            border-radius: 4px;
            height: 8px;
        }

        .modern-slider::-moz-range-thumb {
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #10b981;
            cursor: pointer;
            border: 3px solid #ffffff;
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
            border: none;
        }

        .modern-slider::-moz-range-track {
            background: #e5e7eb;
            border-radius: 4px;
            height: 8px;
            border: none;
        }

        select option {
            background: white;
            color: #111827;
        }

        /* PWA Loading Animation */
        .loading-spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #10b981;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="root">
        <!-- Loading fallback -->
        <div class="min-h-screen bg-gray-50 flex items-center justify-center">
            <div class="text-center space-y-4">
                <div class="loading-spinner mx-auto"></div>
                <p class="text-gray-600">Caricamento app...</p>
            </div>
        </div>
    </div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Lucide icons as components (simplified)
        const Settings = () => React.createElement('svg', { 
            className: "w-5 h-5", 
            fill: "none", 
            stroke: "currentColor", 
            viewBox: "0 0 24 24" 
        }, React.createElement('path', { 
            strokeLinecap: "round", 
            strokeLinejoin: "round", 
            strokeWidth: 2, 
            d: "M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" }), React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M15 12a3 3 0 11-6 0 3 3 0 016 0z" }));

        const ChevronDown = () => React.createElement('svg', { className: "w-5 h-5", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" }, React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "m6 9 6 6 6-6" }));

        const Plus = () => React.createElement('svg', { className: "w-5 h-5", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" }, React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M12 4v16m8-8H4" }));

        const X = () => React.createElement('svg', { className: "w-4 h-4", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" }, React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "m6 6 12 12M6 18 18 6" }));

        const Calculator = () => React.createElement('svg', { className: "w-5 h-5", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" }, React.createElement('rect', { x: "4", y: "2", width: "16", height: "20", rx: "2" }), React.createElement('line', { x1: "8", x2: "16", y1: "6", y2: "6" }), React.createElement('line', { x1: "16", x2: "16", y1: "14", y2: "18" }), React.createElement('path', { d: "M16 10h.01" }), React.createElement('path', { d: "M12 10h.01" }), React.createElement('path', { d: "M8 10h.01" }), React.createElement('path', { d: "M12 14h.01" }), React.createElement('path', { d: "M8 14h.01" }), React.createElement('path', { d: "M8 18h.01" }));

        const Zap = () => React.createElement('svg', { className: "w-4 h-4", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" }, React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M13 2L3 14h9l-1 8 10-12h-9l1-8z" }));

        function TeslaSuperchargerCalculator() {
            const [arrivalPercentage, setArrivalPercentage] = useState(20);
            const [targetPercentage, setTargetPercentage] = useState(80);
            const [pricePerKwh, setPricePerKwh] = useState(0.60);
            const [selectedCar, setSelectedCar] = useState('Tesla Model 3');
            const [customCars, setCustomCars] = useState([]);
            const [showAddCar, setShowAddCar] = useState(false);
            const [newCarName, setNewCarName] = useState('');
            const [newCarBattery, setNewCarBattery] = useState('');

            const defaultCars = {
                "Tesla Model 3": 78.1,
                "Tesla Model Y": 75.0,
                "Tesla Model S": 100.0,
                "Tesla Model X": 100.0
            };

            const allCars = { ...defaultCars };
            customCars.forEach(car => {
                allCars[car.name] = car.battery;
            });

            const currentBattery = allCars[selectedCar] || 78.1;

            const addCustomCar = () => {
                if (newCarName.trim() && newCarBattery && !isNaN(parseFloat(newCarBattery))) {
                    const newCar = {
                        name: newCarName.trim(),
                        battery: parseFloat(newCarBattery)
                    };
                    setCustomCars([...customCars, newCar]);
                    setSelectedCar(newCar.name);
                    setNewCarName('');
                    setNewCarBattery('');
                    setShowAddCar(false);
                }
            };

            const removeCustomCar = (carName) => {
                setCustomCars(customCars.filter(car => car.name !== carName));
                if (selectedCar === carName) {
                    setSelectedCar('Tesla Model 3');
                }
            };

            const initialEnergy = (arrivalPercentage * currentBattery) / 100;
            const finalEnergy = (targetPercentage * currentBattery) / 100;
            const energyToCharge = finalEnergy - initialEnergy;
            const totalCost = energyToCharge * pricePerKwh;

            return React.createElement('div', { className: "min-h-screen bg-gray-50 text-gray-900" },
                // Header
                React.createElement('div', { className: "bg-white shadow-sm" },
                    React.createElement('div', { className: "max-w-md mx-auto px-6 py-4" },
                        React.createElement('div', { className: "flex items-center justify-between" },
                            React.createElement('div', { className: "flex items-center space-x-3" },
                                React.createElement('div', { className: "w-10 h-10 rounded-xl overflow-hidden" },
                                    React.createElement('svg', { viewBox: "0 0 1024 1024", className: "w-full h-full" },
                                        React.createElement('rect', { x: "0", y: "0", width: "1024", height: "1024", rx: "240", ry: "240", fill: "#e53e3e" }),
                                        React.createElement('rect', { x: "50", y: "50", width: "924", height: "924", rx: "220", ry: "220", fill: "#9c2727", opacity: "0.6" }),
                                        React.createElement('rect', { x: "200", y: "250", width: "380", height: "520", rx: "30", ry: "30", fill: "white" }),
                                        React.createElement('rect', { x: "240", y: "290", width: "300", height: "160", rx: "15", ry: "15", fill: "#c53030" }),
                                        React.createElement('path', { d: "M330 330 L390 410 L360 410 L420 470 L360 390 L390 390 L330 330 Z", fill: "white" }),
                                        React.createElement('path', { d: "M280 480 L380 620 L330 620 L430 720 L330 580 L380 580 L280 480 Z", fill: "#e53e3e" }),
                                        React.createElement('path', { d: "M600 380 Q680 340 730 420 Q780 500 730 580 Q680 660 600 620", stroke: "white", strokeWidth: "50", fill: "none", strokeLinecap: "round" }),
                                        React.createElement('rect', { x: "700", y: "560", width: "100", height: "70", rx: "15", ry: "15", fill: "white" }),
                                        React.createElement('rect', { x: "720", y: "540", width: "15", height: "30", fill: "white" }),
                                        React.createElement('rect', { x: "765", y: "540", width: "15", height: "30", fill: "white" }),
                                        React.createElement('rect', { x: "160", y: "730", width: "460", height: "50", rx: "25", ry: "25", fill: "white" })
                                    )
                                ),
                                React.createElement('div', {},
                                    React.createElement('h1', { className: "text-lg font-semibold" }, "Charging Calculator"),
                                    React.createElement('p', { className: "text-xs text-gray-500" }, "Costo ricarica")
                                )
                            ),
                            React.createElement(Settings)
                        )
                    )
                ),

                React.createElement('div', { className: "max-w-md mx-auto p-6 space-y-6" },
                    // Main Charging Card
                    React.createElement('div', { className: "bg-white rounded-2xl p-6 shadow-sm border border-gray-100" },
                        React.createElement('div', { className: "text-center space-y-6" },
                            // Car Selection
                            React.createElement('div', { className: "space-y-3" },
                                React.createElement('div', { className: "text-sm font-medium text-gray-600" }, "Veicolo"),
                                React.createElement('div', { className: "relative" },
                                    React.createElement('select', {
                                        value: selectedCar,
                                        onChange: (e) => setSelectedCar(e.target.value),
                                        className: "w-full bg-gray-50 border border-gray-200 rounded-xl p-4 text-gray-900 appearance-none focus:border-green-500 focus:ring-2 focus:ring-green-500/20 transition-all"
                                    },
                                        Object.entries(allCars).map(([name, battery]) =>
                                            React.createElement('option', { key: name, value: name }, name)
                                        )
                                    ),
                                    React.createElement(ChevronDown, { className: "absolute right-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400 pointer-events-none" })
                                ),
                                React.createElement('div', { className: "text-xs text-gray-500" }, `${currentBattery} kWh batteria`)
                            ),

                            // Large Battery Circle
                            React.createElement('div', { className: "relative w-40 h-40 mx-auto" },
                                React.createElement('svg', { className: "w-full h-full transform -rotate-90", viewBox: "0 0 160 160" },
                                    React.createElement('circle', {
                                        cx: "80",
                                        cy: "80",
                                        r: "70",
                                        stroke: "#f3f4f6",
                                        strokeWidth: "12",
                                        fill: "none"
                                    }),
                                    React.createElement('circle', {
                                        cx: "80",
                                        cy: "80",
                                        r: "70",
                                        stroke: "#10b981",
                                        strokeWidth: "12",
                                        fill: "none",
                                        strokeDasharray: `${(arrivalPercentage / 100) * 439.82} 439.82`,
                                        strokeLinecap: "round",
                                        className: "transition-all duration-1000 ease-out"
                                    })
                                ),
                                React.createElement('div', { className: "absolute inset-0 flex flex-col items-center justify-center" },
                                    React.createElement('div', { className: "text-3xl font-light text-gray-900" }, arrivalPercentage),
                                    React.createElement('div', { className: "text-xs text-gray-500 font-medium" }, "%")
                                )
                            )
                        )
                    ),

                    // Controls Grid
                    React.createElement('div', { className: "grid grid-cols-2 gap-4" },
                        // Arrival Percentage
                        React.createElement('div', { className: "bg-white rounded-2xl p-4 shadow-sm border border-gray-100" },
                            React.createElement('div', { className: "space-y-3" },
                                React.createElement('div', { className: "text-sm font-medium text-gray-600" }, "Arrivo"),
                                React.createElement('div', { className: "text-2xl font-light text-gray-900" }, `${arrivalPercentage}%`),
                                React.createElement('input', {
                                    type: "range",
                                    min: "5",
                                    max: "95",
                                    value: arrivalPercentage,
                                    onChange: (e) => setArrivalPercentage(Number(e.target.value)),
                                    className: "w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer modern-slider"
                                })
                            )
                        ),

                        // Target Percentage
                        React.createElement('div', { className: "bg-white rounded-2xl p-4 shadow-sm border border-gray-100" },
                            React.createElement('div', { className: "space-y-3" },
                                React.createElement('div', { className: "text-sm font-medium text-gray-600" }, "Obiettivo"),
                                React.createElement('div', { className: "text-2xl font-light text-gray-900" }, `${targetPercentage}%`),
                                React.createElement('input', {
                                    type: "range",
                                    min: "10",
                                    max: "100",
                                    value: targetPercentage,
                                    onChange: (e) => setTargetPercentage(Number(e.target.value)),
                                    className: "w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer modern-slider target"
                                })
                            )
                        )
                    ),

                    // Price Card
                    React.createElement('div', { className: "bg-white rounded-2xl p-6 shadow-sm border border-gray-100" },
                        React.createElement('div', { className: "space-y-4" },
                            React.createElement('div', { className: "flex items-center justify-between" },
                                React.createElement('div', { className: "text-sm font-medium text-gray-600" }, "Prezzo per kWh"),
                                React.createElement(Zap, { className: "w-4 h-4 text-green-500" })
                            ),
                            React.createElement('div', { className: "flex items-center space-x-2" },
                                React.createElement('span', { className: "text-lg text-gray-500" }, "€"),
                                React.createElement('input', {
                                    type: "number",
                                    value: pricePerKwh,
                                    onChange: (e) => setPricePerKwh(parseFloat(e.target.value) || 0),
                                    step: "0.01",
                                    min: "0",
                                    className: "flex-1 text-2xl font-light bg-transparent focus:outline-none text-gray-900",
                                    placeholder: "0.60"
                                })
                            )
                        )
                    ),

                    // Result Card
                    React.createElement('div', { className: "bg-gradient-to-r from-green-500 to-green-600 rounded-2xl p-6 text-white shadow-lg" },
                        React.createElement('div', { className: "space-y-4" },
                            React.createElement('div', { className: "flex items-center justify-between" },
                                React.createElement('div', { className: "text-sm font-medium opacity-90" }, "Costo Totale"),
                                React.createElement(Calculator)
                            ),
                            React.createElement('div', { className: "text-4xl font-light" }, `€${totalCost.toFixed(2)}`),
                            React.createElement('div', { className: "text-sm opacity-75" }, `${energyToCharge.toFixed(1)} kWh da ricaricare`)
                        )
                    ),

                    // Additional Info Cards
                    React.createElement('div', { className: "grid grid-cols-3 gap-3" },
                        React.createElement('div', { className: "bg-white rounded-xl p-4 shadow-sm border border-gray-100 text-center" },
                            React.createElement('div', { className: "text-xs text-gray-500 mb-1" }, "Energia"),
                            React.createElement('div', { className: "text-sm font-medium text-gray-900" }, `${energyToCharge.toFixed(1)} kWh`)
                        ),
                        React.createElement('div', { className: "bg-white rounded-xl p-4 shadow-sm border border-gray-100 text-center" },
                            React.createElement('div', { className: "text-xs text-gray-500 mb-1" }, "Tempo stimato"),
                            React.createElement('div', { className: "text-sm font-medium text-gray-900" }, `~${Math.round(energyToCharge * 1.5)} min`)
                        ),
                        React.createElement('div', { className: "bg-white rounded-xl p-4 shadow-sm border border-gray-100 text-center" },
                            React.createElement('div', { className: "text-xs text-gray-500 mb-1" }, "Autonomia +"),
                            React.createElement('div', { className: "text-sm font-medium text-gray-900" }, `${Math.round(energyToCharge * 4)} km`)
                        )
                    ),

                    // Add Vehicle Button/Form
                    !showAddCar ? 
                        React.createElement('button', {
                            onClick: () => setShowAddCar(true),
                            className: "w-full bg-white border-2 border-dashed border-gray-300 rounded-2xl p-6 hover:border-green-400 hover:bg-green-50 transition-all flex items-center justify-center space-x-2 text-gray-600"
                        },
                            React.createElement(Plus),
                            React.createElement('span', { className: "font-medium" }, "Aggiungi Veicolo")
                        ) :
                        React.createElement('div', { className: "bg-white rounded-2xl p-6 shadow-sm border border-gray-100 space-y-4" },
                            React.createElement('div', { className: "flex justify-between items-center" },
                                React.createElement('span', { className: "text-sm font-medium text-gray-600" }, "Nuovo Veicolo"),
                                React.createElement('button', {
                                    onClick: () => {
                                        setShowAddCar(false);
                                        setNewCarName('');
                                        setNewCarBattery('');
                                    },
                                    className: "text-gray-400 hover:text-gray-600"
                                }, React.createElement(X))
                            ),
                            React.createElement('input', {
                                type: "text",
                                placeholder: "Nome veicolo",
                                value: newCarName,
                                onChange: (e) => setNewCarName(e.target.value),
                                className: "w-full bg-gray-50 border border-gray-200 rounded-xl p-4 text-gray-900 placeholder-gray-500 focus:border-green-500 focus:ring-2 focus:ring-green-500/20 transition-all"
                            }),
                            React.createElement('input', {
                                type: "number",
                                placeholder: "Capacità batteria (kWh)",
                                value: newCarBattery,
                                onChange: (e) => setNewCarBattery(e.target.value),
                                step: "0.1",
                                className: "w-full bg-gray-50 border border-gray-200 rounded-xl p-4 text-gray-900 placeholder-gray-500 focus:border-green-500 focus:ring-2 focus:ring-green-500/20 transition-all"
                            }),
                            React.createElement('button', {
                                onClick: addCustomCar,
                                className: "w-full bg-green-500 hover:bg-green-600 text-white font-medium py-4 px-4 rounded-xl transition-colors"
                            }, "Aggiungi Veicolo")
                        ),

                    // Custom Cars List
                    customCars.length > 0 && React.createElement('div', { className: "space-y-3" },
                        React.createElement('div', { className: "text-sm font-medium text-gray-600" }, "Veicoli Personalizzati"),
                        React.createElement('div', { className: "space-y-2" },
                            customCars.map((car) =>
                                React.createElement('div', { key: car.name, className: "flex items-center justify-between bg-white rounded-xl p-4 shadow-sm border border-gray-100" },
                                    React.createElement('div', {},
                                        React.createElement('div', { className: "text-sm font-medium text-gray-900" }, car.name),
                                        React.createElement('div', { className: "text-xs text-gray-500" }, `${car.battery} kWh`)
                                    ),
                                    React.createElement('button', {
                                        onClick: () => removeCustomCar(car.name),
                                        className: "text-red-400 hover:text-red-600 p-1"
                                    }, React.createElement(X))
                                )
                            )
                        )
                    ),

                    // Footer Info
                    React.createElement('div', { className: "bg-blue-50 rounded-2xl p-4 border border-blue-100" },
                        React.createElement('div', { className: "flex items-start space-x-3" },
                            React.createElement('div', { className: "w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0" },
                                React.createElement(Zap, { className: "w-4 h-4 text-blue-600" })
                            ),
                            React.createElement('div', {},
                                React.createElement('div', { className: "text-sm font-medium text-blue-900" }, "Suggerimento"),
                                React.createElement('div', { className: "text-xs text-blue-700 mt-1" }, "Controlla sempre il prezzo sul display del Supercharger prima di iniziare la ricarica.")
                            )
                        )
                    )
                )
            );
        }

        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => console.log('SW registered'))
                    .catch(registrationError => console.log('SW registration failed'));
            });
        }

        ReactDOM.render(React.createElement(TeslaSuperchargerCalculator), document.getElementById('root'));
    </script>
</body>
</html>